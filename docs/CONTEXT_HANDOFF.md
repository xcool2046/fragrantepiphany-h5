# Context Handoff: Fragrant Epiphany H5

## ğŸ“Š å½“å‰è¿›åº¦å¿«ç…§ (Progress Snapshot)
- **é¡¹ç›®é˜¶æ®µ**: **Admin Panel åŠŸèƒ½å®Œå¤‡ä¸æ–‡æ¡£å¯¹é½é˜¶æ®µ**ã€‚æ ¸å¿ƒä¸šåŠ¡ï¼ˆæŠ½ç‰Œã€è§£ç‰Œã€é¦™æ°´æ¨èï¼‰å·²ä¸Šçº¿ï¼Œåå°ç®¡ç†ï¼ˆå¡ç‰Œ/é¦™æ°´/é—®å·/è§£è¯»ï¼‰å·²å®ç°ï¼Œæ–‡æ¡£å·²å…¨é¢å®¡è®¡æ›´æ–°ã€‚
- **å·²éªŒè¯åŠŸèƒ½**:
  1.  **Admin Login**: ä¿®å¤ 500 é”™è¯¯ï¼ˆè¡¥å…¨ `JWT_SECRET`ï¼‰ï¼Œé€šè¿‡ `curl` æœ¬åœ°éªŒè¯æˆåŠŸã€‚
  2.  **Tarot Data**: 78 å¼ ç‰Œçš„ä¸­è‹±æ–‡è§£è¯»æ•°æ®å·²é€šè¿‡ `fix_tarot_data_v2.ts` è„šæœ¬ä¿®å¤å¹¶æ ¸å¯¹ï¼ˆè§£å†³ Excel åˆ—é”™ä½é—®é¢˜ï¼‰ã€‚
  3.  **Perfume Journey**: æ•°æ®åº“ `perfumes` è¡¨æ•°æ®å®Œæ•´ï¼Œå‰ç«¯åŒè¯­æ˜¾ç¤ºæ­£å¸¸ï¼ˆæ–‡æ¡£å·²æ›´æ–°ï¼‰ã€‚
  4.  **Deployment**: `deploy.sh` è„šæœ¬ï¼ˆLocal Build + Static Dockerï¼‰å·²åœ¨ç”Ÿäº§ç¯å¢ƒéªŒè¯å¯è¡Œã€‚
  5.  **Interp API**: `InterpretationController` æä¾›è§£è¯»åº“çš„å¢åˆ æ”¹æŸ¥ä¸å¯¼å…¥å¯¼å‡ºæ¥å£ã€‚

## ğŸ’¡ å…³é”®æŠ€æœ¯æ–¹æ¡ˆä¸æŠ€å·§ (Key Solutions & Techniques)
- **Admin é‰´æƒ (JWT)**:
  - **é—®é¢˜**: `AuthModule` å¯åŠ¨æŠ¥é”™æˆ–ç™»å½• 500ã€‚
  - **æ–¹æ¡ˆ**: å¿…é¡»åœ¨ `.env` ä¸­é…ç½® `JWT_SECRET`ã€‚ä»£ç å·²é‡æ„ä¸º `JwtModule.registerAsync`ï¼Œé…ç½®ç¼ºå¤±ä¼šæ˜¾å¼æŠ›å‡º Errorï¼Œé¿å…é™é»˜å¤±è´¥ã€‚
- **å¡”ç½—æ•°æ®æ¸…æ´— (Data Fix)**:
  - **é—®é¢˜**: æº Excel æ–‡ä»¶ä¸­è‹±æ–‡åä¹±åºï¼Œå¯¼è‡´è§£è¯»é”™é…ã€‚
  - **æ–¹æ¡ˆ**: ä½¿ç”¨ `backend/scripts/fix_tarot_data_v2.ts`ã€‚**æŠ€å·§**ï¼šè‹±æ–‡è§£è¯»æŒ‰é¡ºåºè¯»å–ï¼ˆå¿½ç•¥ Excel ç¬¬ä¸€åˆ—ä¹±åºåç§°ï¼‰ï¼Œä¸­æ–‡è§£è¯»æŒ‰åç§°åŒ¹é…è¯»å–ï¼›ç‰¹æ®Šå¤„ç† `è‡ªæˆ‘æ­£å¼.xlsx` çš„åˆ—åç§»ã€‚
- **ä½é…æœåŠ¡å™¨éƒ¨ç½² (Deployment)**:
  - **é—®é¢˜**: æœåŠ¡å™¨å†…å­˜ä¸è¶³ï¼Œ`npm install / build` å¯¼è‡´æ­»æœºã€‚
  - **æ–¹æ¡ˆ**: **ä¸¥ç¦åœ¨æœåŠ¡å™¨æ„å»º**ã€‚ä½¿ç”¨ `./deploy.sh`ï¼šæœ¬åœ°æ„å»º `dist` -> `rsync` ä¸Šä¼  -> æœåŠ¡å™¨ Docker ä»… `COPY` é™æ€æ–‡ä»¶ã€‚
- **å›½é™…åŒ–å­—æ®µ (i18n)**:
  - **çº¦å®š**: DB å®ä½“å­—æ®µç»Ÿä¸€ä¸º `field` (ä¸­) / `field_en` (è‹±)ã€‚å‰ç«¯æ ¹æ® `i18n.language` åŠ¨æ€å–å€¼ï¼Œä¸æ‹†åˆ†è¡¨ã€‚

## ğŸš§ é—ç•™éš¾ç‚¹ä¸å¾…åŠ (Pending Issues)
- **Rules è¡¨æ•°æ®ä¸ºç©º (Clarification)**:
  - **çŠ¶æ€**: ç›®å‰ `matchRule` ä½¿ç”¨åˆæˆè§„åˆ™å…œåº•ï¼ˆSynthetic Ruleï¼‰ï¼Œå³ç›´æ¥æ‹¼æ¥ä¸‰å¼ ç‰Œçš„è§£è¯»ã€‚
  - **åç»­**: è‹¥éœ€ç²¾ç»†åŒ–è§„åˆ™ï¼ˆç‰¹å®šç‰Œç»„è§¦å‘ç‰¹å®šæ–‡æ¡ˆï¼‰ï¼Œéœ€å¯¼å…¥ `rules` è¡¨æ•°æ®ã€‚
- **Stripe ä»·æ ¼é…ç½® (Configuration)**:
  - **çŠ¶æ€**: ä»£ç æ”¯æŒ `STRIPE_PRICE_IDS_JSON`ï¼Œä½†éœ€ç¡®è®¤ç”Ÿäº§ç¯å¢ƒ `.env` æ˜¯å¦å·²æ›´æ–°ä¸ºè¯¥ JSON æ ¼å¼ï¼ˆåŸä¸ºåˆ†æ•£å˜é‡ï¼‰ã€‚
  - **çº¿ç´¢**: `backend/src/pay/pay.service.ts` ä¼˜å…ˆè¯»å– JSON é…ç½®ã€‚
- **Admin è®¢å•ç®¡ç† (Hidden)**:
  - **çŠ¶æ€**: ä»£ç å·²å®ç°ä½†è¢« Feature Flag `FEATURE_ADMIN_ORDERS=false` éšè—ã€‚
  - **æ³¨æ„**: æš‚ä¸å»ºè®®å¼€å¯ï¼Œé™¤éå®¢æˆ·æ˜ç¡®è¦æ±‚ç®¡ç†è®¢å•ã€‚

## ğŸ“‚ æ ¸å¿ƒæ–‡ä»¶ç»“æ„ (Core Directory Structure)
```text
h5-web/
â”œâ”€â”€ docs/                      # Single Source of Truthï¼Œå·²å…¨é¢æ›´æ–°
â”‚   â”œâ”€â”€ 00-guide/              # å¼€å‘(development.md)ä¸éƒ¨ç½²(deployment.md)æŒ‡å—
â”‚   â””â”€â”€ CONTEXT_HANDOFF.md     # æœ¬æ–‡æ¡£
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ .env                   # å¿…é¡»åŒ…å« JWT_SECRET, STRIPE_*, DATABASE_URL
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ admin/             # AdminController (å¡ç‰Œ/é¦™æ°´/é—®å·ç®¡ç†)
â”‚   â”‚   â”œâ”€â”€ auth/              # ç™»å½•é‰´æƒ (JWT)
â”‚   â”‚   â”œâ”€â”€ pay/               # Stripe æ”¯ä»˜é€»è¾‘
â”‚   â”‚   â””â”€â”€ migrations/        # æ•°æ®åº“å˜æ›´ä¸ç§å­æ•°æ®
â”‚   â””â”€â”€ scripts/               # è¿ç»´è„šæœ¬ (fix_tarot_data_v2.ts, seed_*.ts)
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/pages/admin/       # åå°å‰ç«¯é¡µé¢ (Perfumes.tsx, Cards.tsx)
â”‚   â””â”€â”€ src/config/            # ä¸šåŠ¡å¸¸é‡é…ç½®
â””â”€â”€ deploy.sh                  # æ ¸å¿ƒéƒ¨ç½²è„šæœ¬ (å‹¿æ”¹åŠ¨æ ¸å¿ƒé€»è¾‘)
```

## â¡ï¸ ä¸‹ä¸€æ­¥æŒ‡ä»¤ (Next Action)
1.  **ç¯å¢ƒæ£€æŸ¥**: å¯åŠ¨å‰åŠ¡å¿…æ£€æŸ¥ `backend/.env` æ˜¯å¦åŒ…å« `JWT_SECRET`ï¼ˆè¿™æ˜¯æœ€è¿‘ä¿®å¤çš„å…³é”®ç‚¹ï¼‰ã€‚
2.  **æ•°æ®éªŒè¯**: è¿è¡Œ `docker compose exec backend npm run typeorm -- migration:show` ç¡®è®¤æ‰€æœ‰è¿ç§»å·²æ‰§è¡Œã€‚
3.  **Rules æ•°æ®å¯¼å…¥**: ä¼˜å…ˆç€æ‰‹è§£å†³ `rules` è¡¨æ•°æ®ä¸ºç©ºçš„é—®é¢˜ã€‚æŸ¥æ‰¾æ˜¯å¦æœ‰ç›¸å…³ Excel æˆ–éœ€æ±‚æ–‡æ¡£ï¼Œç¼–å†™ Seeding è„šæœ¬ã€‚
4.  **Admin éªŒæ”¶**: æœ¬åœ°å¯åŠ¨ (`npm run dev` in both folders)ï¼Œè®¿é—® `http://localhost:4173/admin` (å‰ç«¯) æˆ– `http://localhost:8080/admin` (Docker)ï¼Œä½¿ç”¨ `admin/admin` ç™»å½•ï¼ŒéªŒè¯é¦™æ°´/å¡ç‰Œç®¡ç†çš„ CRUD åŠŸèƒ½ã€‚
5.  **éƒ¨ç½²**: è‹¥éœ€ä¸Šçº¿ï¼Œç›´æ¥è¿è¡Œ `./deploy.sh "update docs and admin fix"`ï¼Œ**ä¸è¦**æ‰‹åŠ¨åœ¨æœåŠ¡å™¨æ“ä½œ git pull / npm installã€‚
