# Project Handover: Fragrant Epiphany (H5)

**Date**: 2025-11-27
**Status**: Production Deployment Stable (with Data Gaps)

## 1. Project Overview
A Tarot reading H5 application with perfume recommendations.
- **Frontend**: React (Vite) + TypeScript + Tailwind + Framer Motion.
- **Backend**: NestJS + TypeORM + PostgreSQL.
- **Infrastructure**: Docker Compose (Nginx + Backend + DB).

## 2. Current Progress
- **Production Environment**: Fully operational. Nginx serves static frontend and proxies `/api` to backend.
- **Data Synchronization**:
    - **Questions**: Frontend fetches dynamically from DB (`/api/questionnaire/questions`).
    - **Perfumes**: DB populated with 168 records (imported from Excel). Frontend fetches dynamically.
- **Deployment Workflow**: Established "Local Build (`VITE_API_BASE_URL=/api`) + SCP Upload" method.

## 3. Resolved Issues
- **White Screen on Production**: Caused by absolute API URL (`localhost:3000`) in build. Fixed by using relative path `/api`.
- **Missing Perfume Data**: Created `perfumes` table and migration script to seed data from Excel.
- **Documentation**: Cleaned up `docs/` folder, archived obsolete proposals, and consolidated Perfume feature docs.

## 4. Remaining Challenges (Next Steps)
1.  **Rules Data (Critical)**:
    - The `rules` table (mapping "Card + Question Answer" to "Interpretation") is **EMPTY**.
    - *Current Behavior*: System falls back to displaying individual card meanings (Past/Present/Future) instead of a synthesized interpretation.
    - *Action*: Need to import or create rule data.
2.  **Admin Panel**:
    - Basic auth works.
    - Needs updates to support the new `perfumes` and `rules` schema for content management.
3.  **Translation**:
    - Dynamic content (Perfume descriptions) needs Chinese translation verification.

## 5. Core Directory Structure
```
/home/code/h5-web/
├── backend/                 # NestJS Application
│   ├── src/migrations/      # DB Migrations (check here for data seeds)
│   └── scripts/             # Utility scripts (e.g., read_excel.ts)
├── frontend/                # React Application
│   ├── dist/                # Production build artifacts (uploaded to server)
│   └── src/pages/           # Core Views (Home, Question, Draw, Result, PerfumeView)
├── docs/                    # Documentation
│   ├── deploy-guide.md      # Deployment instructions
│   ├── dev-guide.md         # Development setup & DB schema
│   ├── feature-perfume.md   # Perfume feature specs
│   └── archive/             # Obsolete docs
├── nginx.conf               # Production Nginx Config
├── deploy.sh                # Deployment Script
└── docker-compose.yml       # Service Orchestration
```

## 6. Quick Start (Production Fix/Deploy)
If you need to redeploy:
```bash
# 1. Build Frontend (Local)
cd frontend
VITE_API_BASE_URL=/api npm run build

# 2. Upload to Server
scp -r dist/* root@47.243.157.75:/root/fragrantepiphany-h5/frontend/dist/

# 3. Restart Nginx (Server)
ssh root@47.243.157.75 "cd fragrantepiphany-h5 && docker compose restart nginx"
```
